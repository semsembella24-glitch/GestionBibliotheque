from datetime import datetime

class Livre:
    def __init__(self, titre, auteur):
        self._titre = titre
        self._auteur = auteur
        self._disponible = True

    @property
    def titre(self):
        return self._titre

    @property
    def auteur(self):
        return self._auteur

    @property
    def disponible(self):
        return self._disponible

    def emprunter(self):
        if self._disponible:
            self._disponible = False
            return True
        return False

    def retourner(self):
        self._disponible = True

    def __str__(self):
        etat = "Disponible" if self._disponible else "EmpruntÃ©"
        return f"{self._titre} par {self._auteur} - {etat}"

class Utilisateur:
    def __init__(self, nom):
        self._nom = nom
        self._livres_empruntes = []

    @property
    def nom(self):
        return self._nom

    @property
    def livres_empruntes(self):
        return self._livres_empruntes.copy()

    def emprunter_livre(self, livre):
        if livre.emprunter():
            self._livres_empruntes.append(livre)
            return True
        return False

    def retourner_livre(self, livre):
        if livre in self._livres_empruntes:
            livre.retourner()
            self._livres_empruntes.remove(livre)
            return True
        return False

class Emprunt:
    def __init__(self, utilisateur, livre):
        self._utilisateur = utilisateur
        self._livre = livre
        self._date = datetime.now()
        self._actif = True

    @property
    def utilisateur(self):
        return self._utilisateur

    @property
    def livre(self):
        return self._livre

    @property
    def date(self):
        return self._date

    @property
    def actif(self):
        return self._actif

    def cloturer(self):
        if self._actif:
            self._livre.retourner()
            self._actif = False

class Bibliotheque:
    def __init__(self):
        self._livres = []
        self._utilisateurs = []
        self._emprunts_actifs = []

    @property
    def livres(self):
        return self._livres.copy()

    @property
    def utilisateurs(self):
        return self._utilisateurs.copy()

    @property
    def emprunts_actifs(self):
        return self._emprunts_actifs.copy()

    def ajouter_livre(self, livre):
        self._livres.append(livre)

    def inscrire_utilisateur(self, utilisateur):
        self._utilisateurs.append(utilisateur)

    def emprunter_livre(self, utilisateur, livre):
        if utilisateur.emprunter_livre(livre):
            emprunt = Emprunt(utilisateur, livre)
            self._emprunts_actifs.append(emprunt)
            return emprunt
        return None

    def retourner_livre(self, emprunt):
        if emprunt in self._emprunts_actifs:
            emprunt.cloturer()
            self._emprunts_actifs.remove(emprunt)

    def afficher_etat(self):
        print("ðŸ“š Livres :")
        for livre in self._livres:
            print(livre)
        print("\nðŸ“„ Emprunts actifs :")
        for emprunt in self._emprunts_actifs:
            print(f"{emprunt.livre.titre} empruntÃ© par {emprunt.utilisateur.nom}")

if __name__ == "__main__":
    bibliotheque = Bibliotheque()

    livre1 = Livre("Une brÃ¨ve histoire de presque tout", "Bill Bryson")
    livre2 = Livre("Le GÃ¨ne Ã©goÃ¯ste", "Richard Dawkins")
    livre3 = Livre("Cosmos", "Carl Sagan")
    livre4 = Livre("La CuillÃ¨re disparue", "Sam Kean")

    for livre in [livre1, livre2, livre3, livre4]:
        bibliotheque.ajouter_livre(livre)

    mouna = Utilisateur("Mouna")
    wissam = Utilisateur("Wissam")
    bibliotheque.inscrire_utilisateur(mouna)
    bibliotheque.inscrire_utilisateur(wissam)

    emprunt1 = bibliotheque.emprunter_livre(wissam, livre1)
    emprunt2 = bibliotheque.emprunter_livre(mouna, livre3)

    bibliotheque.afficher_etat()

    bibliotheque.retourner_livre(emprunt1)
    print("\nAprÃ¨s retour d'un livre :")
    bibliotheque.afficher_etat()
